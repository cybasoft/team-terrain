[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
user=root

[program:postgresql]
command=/usr/bin/postgres -D /var/lib/postgresql/data -c config_file=/etc/postgresql/postgresql.conf
user=postgres
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/postgresql/postgresql.log
priority=100

[program:backend]
command=bun run /app/backend/src/server.js
user=appuser
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/backend.log
environment=NODE_ENV=production,DB_HOST=localhost,DB_PORT=5432,DB_NAME=teamterrain,DB_USER=postgres,DB_PASSWORD=password,JWT_SECRET=your-super-secret-jwt-key-change-in-production,API_AUTH_TOKEN=your-api-auth-token-change-this,PORT=3001
priority=200
depends_on=postgresql

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
user=root
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/nginx.log
priority=300
depends_on=backend

[program:init-db]
command=/docker-entrypoint-initdb.d/init-db.sh
user=appuser
autostart=true
autorestart=false
startsecs=0
exitcodes=0
redirect_stderr=true
stdout_logfile=/var/log/supervisor/init-db.log
priority=150
depends_on=postgresql
